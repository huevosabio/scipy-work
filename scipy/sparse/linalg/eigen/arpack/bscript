import sys

from bento.commands import hooks

@hooks.pre_build
def pre_build(context):
    default_builder = context.default_builder

    def builder(extension):
        sources = extension.sources[:]
        return default_builder(extension,
                               features="c fc cstlib pyext bento",
                               source=sources,
                               # Hack to make use of claoadable flags for static archive
                               use="cshlib")
    context.register_compiled_library_builder("arpack", builder)

    context.tweak_extension("_arpack", features="c fc pyext cshlib f2py bento",
                          use="arpack LAPACK CLIB")
